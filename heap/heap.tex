\section{Heap}
There are two ways to allocate the memory necessary to store and manipulate data;
statically, and dynamically. In the previous section, we saw how one
specific sort of dynamic allocation - stack-based - could lead to
security vulnerabilities when proper precautions aren't taken. In this section,
we will shift focus to another sort of dynamically allocated memory, and how
certain mistakes with dealing with such memory can lead to exploitation
of the vulnerable program. There are some major differences between
dynamically and statically allocated memory. Obviously, dynamically
allocated memory can vary in size and location at runtime \emph{by default}.
So, even without any countermeasures to consider, we should expect
the location and size of various buffers and memory structures to change
based on the program's previous behaviour. As we focus on glibc 2.11.2,
we will note that its dynamic memory allocation/management algorithms - 
collectively known as ptmalloc/dlmalloc - are deterministic. We take
advantage of this in our simple programs to make demonstrations easier,
but in practice the complex nature of a vulnerable program would make
extra steps necessary. For example, a vulnerable http server might
require a certain number of carefully formatted requests in order
to massage the heap into a form necessary for (or conducive to) to exploitation.
This would further be complicated by any current users of the server,
which is entirely outside our control.

To simply demonstrate the concepts, we will be focusing on very simple
example programs, beginning with a very straightforward buffer overflow.
It should be noted that the details of ptmalloc/dlmalloc may change from
challenge to challenge. It seems that some are designed to be possible
without abusing the ptmalloc/dlmalloc algorithm itself, while others require
this more complicated approach. Thus, the ``easier" challenges will have
protections still in place, while the ``harder" challenges actually have
countermeasures removed, and other simplifications made. This can help
make learning easier, but you should remember this when you expand
on this knowledge by examining other scenarios.

%should we discuss the basics of dlmalloc/ptmalloc here? or just provide references?

%basic example
\input{heap/basics.tex}

\input{heap/chunk_corruption.tex}
